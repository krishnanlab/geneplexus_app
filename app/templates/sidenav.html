<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='sidenav.css') }}">
<div class="sidenav">
    <form id="model-form" action="{{ url_for('validate') }}" method="POST", enctype="multipart/form-data">
        <div class="item-content">
           <span>
               <br>
               <fieldset class="border box_padding fieldset">
                   <div class="button_padding">
                       <!-- Button trigger modal -->
                       <label>
                           1. Enter/Load Gene Set
                       </label>
                       <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                        data-content="Manually input a gene set or upload a file containing a gene set as well as see examples for both">
                            <i class="fas fa-question-circle"></i></a>
                       <div class="mb-2">
                        <button type="button" id="geneBtn" class="btn btn-sm sidenav-btn btn-primary"  data-toggle="modal" data-target="#geneModal">
                          {% if valid_form is defined %}Edit Loaded Genes{% else %}Add Genes{% endif %}
                        </button>
                       </div>
                   </div>
               </fieldset>
           </span>
        </div>
    </form>
    {% if valid_form is defined %}
    <form id="model-form" action="{{ url_for('run_model') }}" method="POST", enctype="multipart/form-data">
        <div class="item-content">
            <span>
            {{ valid_form.csrf_token }}
            <br>
                <fieldset class="border box_padding fieldset">
                    <label>
                        2. Job Name
                    </label>
                    <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                        data-content="The default job name is a unique identifier that will be assigned
                        once the model is run.  Optionally, a prefix can be added for easier identification
                            by typing text into the box below. The character limit is {{ prefix_limit }}. Anything longer
                            will be truncated when you submit a job">
                            <i class="fas fa-question-circle"></i></a>
                    <div>
                        <label>(Optional) Add a prefix to the job</label>
                        <div class="d-flex">
                            <span class="flex-grow-1">{{ valid_form.prefix(class_="sidenav-prefix") }}</span>   -   <span>{{ valid_form.jobid(class_="form-control-plaintext sidenav-suffix") }}</span>
                        </div>
                        <small id="char_limit" class="form-text" style="color:red"></small>
                    </div>
                    <br>
                    <label>
                        3. Select Molecular Network
                    </label>
                    <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                        data-content="Select the molecular network that will be used in training the model.">
                    <i class="fas fa-question-circle"></i></a>
                    <div>
                    {{ valid_form.network }}
                    </div>
                    <br>
                    <label>
                        4. Select Feature Type
                    </label>
                    <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                    data-content="Select how the connections of chosen network will be represented as features in the machine learning model.">
                    <i class="fas fa-question-circle"></i></a>
                    <div class="select">
                        {{ valid_form.features }}
                    </div>
                    <br>
                    <label>
                        5. Select Negative Gene Class
                    </label>
                    <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                    data-content="Select the type of genes in the negative class – genes annotated to Gene Ontology Biological Processes or to disease in the DisGeNet database – based on whether the input genes represent a process/pathway or a disease.">
                    <i class="fas fa-question-circle"></i></a>
                    <div class="select">
                        {{ valid_form.negativeclass }}
                    </div>
                    <br>
                    6. (Optional) Notification Email Address
                    </label><a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                    data-content="Optionally enter an email address for job notifications.  We will never share your email address outside of this application, add you to a mailing list, or send unsolicited communication.">
                    <i class="fas fa-question-circle"></i></a>
                    <div class="select">
                        {{ valid_form.notifyaddress(class_="sidenav-email") }}
                    </div>
                    <br>
                    
                    {{ valid_form.runbatch(class_="btn btn-sm btn-primary", style="width: 200px") }}
                    <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right"
                    data-content="Hitting this button will launch a process in the cloud to train the machine learning model.
                    The link to view the results will be available in the Jobs tab when completed.">
                    <i class="fas fa-question-circle"></i></a>
                </fieldset>
            </span>
        </div>
    </form>
    {% else %}
    {% endif %}
</div>

<!-- Modal -->
<div class="modal fade" id="geneModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
          <form id="modal-form" method="POST", enctype="multipart/form-data" action="{{ url_for('validate') }}">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Enter or Paste List of Genes</h5>
              <a href="#" data-toggle="popover" data-trigger="hover" data-placement="right" data-html="true" 
                        data-content="Upload a file of gene IDs or input them manually. <br>
                        Acceptable Gene IDs are: Entrez, ENSG, Symbol, ENSP, ENST. <br>
                        The format is delimited by newline (i.e. each gene is on a separate line)">
                            <i class="fas fa-question-circle"></i></a>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <div class="d-flex flex-row justify-content-between mb-2">
                        <div>
                            <span id="insertGeneButton" class="btn btn-sm btn-primary smaller-text">Select Gene File</span>
                            <span id="insert_filename" class="text-center"></span>
                            <input id="insertGenesInput" style="font-size: 0.0em;"
                                    type="file"
                                    title=" "
                                    name="insert_genes"
                                    accept="txt/csv"
                                    />
                        </div>
                        <div  onclick="sampleGenes()">
                            <button type="button" class="btn btn-sm btn-primary smaller-text">Click to load a Sample Gene Set</button>
                        </div>
                        
                    </div>
                    <div class="d-flex justify-content-end mb-2">
                        <div class="">
                            <button type="button"
                                           id="sampleBtn"
                                           class="btn btn-sm btn-primary smaller-text"
                                           onclick="window.location.href='/uploads/DOID-9562-STRING-Adjacency-DisGeNet-Symbols.txt'">
                                      Download Sample Gene File
                                    </button>
                        </div>
                    </div>
                </div>
              <textarea class="form-control rounded-0" id="enterGenes" rows="18" name="genesInput">{{ '\n'.join(existing_genes) }}</textarea>
            </div>
            <div class="modal-footer">
                <div class="mr-auto">
                    <button type="button" id="clearButton" class="btn btn-secondary">Clear Input</button>
                </div>
                <div>
                    <button type="button" class="btn btn-secondary p-2" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary p-2">Validate</button>
                </div>
            </div>
          </form>
      </div>
    </div>
  </div>

  {% block scripts %}
  <script type='text/javascript' src="{{url_for('static', filename='sidebar.js')}}" defer></script>
  {% endblock %}